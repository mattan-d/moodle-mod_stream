{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main.\n *\n * @package\n * @category    admin\n * @copyright  2024 mattandor <mattan@centricapp.co.il>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/url'], function($, ajax, notification, str, url) {\n  'use strict';\n\n  return {\n    init: function() {\n      var self = this;\n\n      this.elements = $('#stream-elements');\n      this.loadingbars = url.imageUrl('icones/loading-bars', 'stream');\n\n      $('body').on('click', '#stream-elements .list-item-grid', function() {\n        var itemid = $(this).data('itemid');\n        var topic = $(this).find('.title').text();\n\n        self.selected(itemid, topic);\n      });\n\n      $('body').on('click', '#stream-load #stream-sort .btn', function(e) {\n        e.preventDefault();\n        $('#stream-load #stream-sort .btn').removeClass('active');\n        $(this).toggleClass('active');\n        self.load();\n      });\n\n      $('body').on('click', '.btn-upload', function(e) {\n        e.preventDefault();\n        $('#upload_stream').toggle();\n      });\n\n      $('#stream-title-search').val($('#id_topic').val()).keyup(function() {\n        self.load();\n      });\n\n      this.load();\n\n      // Add event listener to receive messages from iframes\n      window.addEventListener('message', function(event) {\n        this.message(event, self);\n      }.bind(this), false);\n    }, message: function(event) {\n      // Check if the message contains the streamid\n      if (event.data && event.data.streamid) {\n        $('#id_identifier').val(event.data.streamid);\n        $('#id_topic').val(event.data.topic);\n        $('#stream-title-search').val(event.data.topic);\n        $('#upload_stream').hide();\n\n        self.elements.html('');\n        var html = '<div class=\"col list-item-grid\" data-itemid=\"' + event.data.streamid + '\" ' + 'id=\"video_identifier_' +\n            event.data.streamid + '\"><span class=\"item selected\"><div class=\"thumbnail\">' + '<img src=\"' + event.data.thumbnail +\n            '\" class=\"img-fluid img-rounded\">' + '</div><span class=\"title\">' + event.data.topic + '</span></span></div>';\n        self.elements.append(html);\n      }\n    }, load: function() {\n      var self = this;\n      var sort = $('#stream-load #stream-sort .btn.active').attr('data-name');\n\n      self.elements.html('<div style=\"text-align:center\"><img height=\"80\" src=\"' + self.loadingbars + '\" ></div>');\n\n      ajax.call([\n        {\n          methodname: 'mod_stream_video_list', args: {\n            term: $('#stream-title-search').val(), courseid: $('input[name=\"course\"]').val(), sort: sort,\n          },\n        }])[0].then(function(response) {\n        return self.list(response, self);\n      }).catch(function(error) {\n        return self.failed(error, self);\n      });\n    }, selected: function(identifier, topic) {\n      setTimeout(function() {\n        $('#id_identifier').val(identifier);\n        $('#id_topic').val(topic);\n        $('#id_name').val(topic);\n        $('.list-item-grid').find('.item').removeClass('selected');\n        $('#video_identifier_' + identifier).find('.item').addClass('selected');\n      }, 100);\n    }, failed: function(error, self) {\n      return str.get_string('servererror', 'moodle').then(function(connectionfailed) {\n        return self.elements.html('<div class=\"alert alert-danger\">' + connectionfailed + '</div>');\n      });\n    }, list: function(response, self) {\n      self.selected($('#id_identifier').val(), $('#id_topic').val());\n      if (response.status == 'success') {\n        if (response.videos.length) {\n          self.elements.html('');\n\n          $.each(response.videos, function(key, video) {\n\n            str.get_strings([{'key': 'views', component: 'mod_stream'}, {'key': 'before', component: 'mod_stream'}]).\n                then(function(string) {\n                  var html = '<div class=\"col list-item-grid\" data-itemid=\"' + video.id + '\" ' + 'id=\"video_identifier_' +\n                      video.id + '\">' + '<span class=\"item\" ><div class=\"thumbnail\">' + '<img src=\"' + video.thumbnail +\n                      '\" class=\"img-fluid img-rounded\">' + '<span class=\"datecreated\">' + video.datecreated +\n                      '</span><span class=\"duration\">' + video.duration + '</span></div><span class=\"title\">' + video.title +\n                      '</span><span class=\"details\">' + video.views + ' ' + string[0] + ' <span class=\"bubble\">‚óè</span>' + ' ' +\n                      string[1] + ' ' + video.elapsed + '</span></span></div>';\n                  self.elements.append(html);\n                });\n          });\n        } else {\n          return str.get_string('noresults', 'mod_stream').then(function(noresults) {\n            return self.elements.html('<div class=\"alert alert-info\">' + noresults + '</div>');\n          });\n        }\n      }\n      return true;\n    },\n  };\n});\n"],"names":["define","$","ajax","notification","str","url","init","self","this","elements","loadingbars","imageUrl","on","itemid","data","topic","find","text","selected","e","preventDefault","removeClass","toggleClass","load","toggle","val","keyup","window","addEventListener","event","message","bind","streamid","hide","html","thumbnail","append","sort","attr","call","methodname","args","term","courseid","then","response","list","catch","error","failed","identifier","setTimeout","addClass","get_string","connectionfailed","status","videos","length","noresults","each","key","video","get_strings","component","string","id","datecreated","duration","title","views","elapsed"],"mappings":"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"}