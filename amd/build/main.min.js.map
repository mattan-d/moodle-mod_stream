{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main.\n *\n * @package\n * @category    admin\n * @copyright  2024 mattandor <mattan@centricapp.co.il>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/url'], function ($, ajax, notification, str, url) {\n    'use strict';\n\n    return {\n        init: function () {\n            var self = this;\n\n            this.elements = $('#stream-elements');\n            this.loadingbars = url.imageUrl('icones/loading-bars', 'stream');\n\n            $('body').on('click', '#stream-elements .list-item-grid', function () {\n                var itemid = $(this).data('itemid');\n                var topic = $(this).find('.title').text();\n\n                self.selected(itemid, topic);\n            });\n\n            $('body').on('click', '.btn-upload', function (e) {\n                e.preventDefault();\n                $('#upload_stream').toggle();\n            });\n\n            $('#stream-title-search')\n                .val($('#id_topic').val())\n                .keyup(function () {\n                    self.load();\n                });\n\n            this.load();\n\n            // Add event listener to receive messages from iframes\n            window.addEventListener('message', function (event) {\n                this.message(event, self);\n            }.bind(this), false);\n        }, message: function (event) {\n            // Check if the message contains the streamid\n            if (event.data && event.data.streamid) {\n                $('#id_identifier').val(event.data.streamid);\n                $('#id_topic').val(event.data.topic);\n                $('#stream-title-search').val(event.data.topic);\n                $('#upload_stream').hide();\n\n                self.elements.html(\"\");\n                var html = '<div class=\"col list-item-grid\" data-itemid=\"' + event.data.streamid + '\" ' + 'id=\"video_identifier_' + event.data.streamid + '\"><span class=\"item selected\"><div class=\"thumbnail\">' + '<img src=\"' + event.data.thumbnail + '\" class=\"img-fluid img-rounded\">' + '</div><span class=\"title\">' + event.data.topic + '</span></span></div>';\n                self.elements.append(html);\n            }\n        }, load: function () {\n            var self = this;\n            self.elements.html('<div style=\"text-align:center\"><img height=\"80\" src=\"' + self.loadingbars + '\" ></div>');\n            $('html, body').animate({\n                scrollTop: self.elements.offset().top - 100\n            }, 800);\n\n            ajax.call([{\n                methodname: 'mod_stream_video_list', args: {\n                    term: $('#stream-title-search').val(), courseid: $('input[name=\"course\"]').val()\n                }\n            }])[0]\n                .then(function (response) {\n                    return self.list(response, self);\n                })\n                .catch(function (error) {\n                    return self.failed(error, self);\n                });\n        }, selected: function (identifier, topic) {\n            setTimeout(function () {\n                $('#id_identifier').val(identifier);\n                $('#id_topic').val(topic);\n                $('.list-item-grid').find('.item').removeClass('selected');\n                $('#video_identifier_' + identifier).find('.item').addClass('selected');\n            }, 100);\n        }, failed: function (error, self) {\n            return str.get_string('servererror', 'moodle')\n                .then(function (connectionfailed) {\n                    return self.elements.html('<div class=\"alert alert-danger\">' + connectionfailed + '</div>');\n                });\n        }, list: function (response, self) {\n            self.selected($('#id_identifier').val(), $('#id_topic').val());\n            if (response.status == 'success') {\n                if (response.videos.length) {\n                    self.elements.html(\"\");\n\n\n                    $.each(response.videos, function (key, video) {\n\n                        str.get_strings([\n                            {'key': 'views', component: 'mod_stream'},\n                            {'key': 'before', component: 'mod_stream'},\n                        ])\n                            .then(function (string) {\n                                var html = '<div class=\"col list-item-grid\" data-itemid=\"' + video.id + '\" ' + 'id=\"video_identifier_' + video.id + '\">' + '<span class=\"item\" ><div class=\"thumbnail\">' + '<img src=\"' + video.thumbnail + '\" class=\"img-fluid img-rounded\">' + '<span class=\"datecreated\">' + video.datecreated + '</span><span class=\"duration\">' + video.duration + '</span></div><span class=\"title\">' + video.title + '</span><span class=\"details\">' + video.views + ' ' + string[0] + ' <span class=\"bubble\">‚óè</span>' + ' ' + string[1] + ' ' + video.elapsed + '</span></span></div>';\n                                self.elements.append(html);\n                            });\n                    });\n                } else {\n                    return str.get_string('noresults', 'mod_stream')\n                        .then(function (noresults) {\n                            return self.elements.html('<div class=\"alert alert-info\">' + noresults + '</div>');\n                        });\n                }\n            }\n            return true;\n        },\n    };\n});\n"],"names":["define","$","ajax","notification","str","url","init","self","this","elements","loadingbars","imageUrl","on","itemid","data","topic","find","text","selected","e","preventDefault","toggle","val","keyup","load","window","addEventListener","event","message","bind","streamid","hide","html","thumbnail","append","animate","scrollTop","offset","top","call","methodname","args","term","courseid","then","response","list","catch","error","failed","identifier","setTimeout","removeClass","addClass","get_string","connectionfailed","status","videos","length","noresults","each","key","video","get_strings","component","string","id","datecreated","duration","title","views","elapsed"],"mappings":"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"}