/**
 * Main.
 *
 * @package
 * @category    admin
 * @copyright  2024 mattandor <mattan@centricapp.co.il>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_stream/main",["jquery","core/ajax","core/notification","core/str","core/url"],(function($,ajax,notification,str,url){return{init:function(){var self=this;this.elements=$("#stream-elements"),this.loadingbars=url.imageUrl("icones/loading-bars","stream"),$("body").on("click","#stream-elements .list-item-grid",(function(){var itemid=$(this).data("itemid"),topic=$(this).find(".title").text();self.selected(itemid,topic)})),$("body").on("click","#stream-load #stream-sort .btn",(function(e){e.preventDefault(),$("#stream-load #stream-sort .btn").removeClass("active"),$(this).toggleClass("active"),self.load()})),$("body").on("click",".btn-upload",(function(e){e.preventDefault(),$("#upload_stream").toggle()})),$("#stream-title-search").val($("#id_topic").val()).keyup((function(){self.load()})),this.load(),window.addEventListener("message",function(event){this.message(event,self)}.bind(this),!1)},message:function(event){if(event.data&&event.data.streamid){$("#id_identifier").val(event.data.streamid),$("#id_topic").val(event.data.topic),$("#stream-title-search").val(event.data.topic),$("#upload_stream").hide(),self.elements.html("");var html='<div class="col list-item-grid" data-itemid="'+event.data.streamid+'" id="video_identifier_'+event.data.streamid+'"><span class="item selected"><div class="thumbnail"><img src="'+event.data.thumbnail+'" class="img-fluid img-rounded"></div><span class="title">'+event.data.topic+"</span></span></div>";self.elements.append(html)}},load:function(){var self=this,sort=$("#stream-load #stream-sort .btn.active").attr("data-name");self.elements.html('<div style="text-align:center"><img height="80" src="'+self.loadingbars+'" ></div>'),ajax.call([{methodname:"mod_stream_video_list",args:{term:$("#stream-title-search").val(),courseid:$('input[name="course"]').val(),sort:sort}}])[0].then((function(response){return self.list(response,self)})).catch((function(error){return self.failed(error,self)}))},selected:function(identifier,topic){setTimeout((function(){$("#id_identifier").val(identifier),$("#id_topic").val(topic),$("#id_name").val(topic),$(".list-item-grid").find(".item").removeClass("selected"),$("#video_identifier_"+identifier).find(".item").addClass("selected")}),100)},failed:function(error,self){return str.get_string("servererror","moodle").then((function(connectionfailed){return self.elements.html('<div class="alert alert-danger">'+connectionfailed+"</div>")}))},list:function(response,self){if(self.selected($("#id_identifier").val(),$("#id_topic").val()),"success"==response.status){if(!response.videos.length)return str.get_string("noresults","mod_stream").then((function(noresults){return self.elements.html('<div class="alert alert-info">'+noresults+"</div>")}));self.elements.html(""),$.each(response.videos,(function(key,video){str.get_strings([{key:"views",component:"mod_stream"},{key:"before",component:"mod_stream"}]).then((function(string){var html='<div class="col list-item-grid" data-itemid="'+event.data.streamid+'" id="video_identifier_'+event.data.streamid+'"><span class="item selected"><div class="thumbnail"><img src="'+event.data.thumbnail+'" class="img-fluid img-rounded"></div><span class="title">'+event.data.topic+"</span></span></div>";self.elements.append(html)}))}))}return!0}}}));

//# sourceMappingURL=main.min.js.map