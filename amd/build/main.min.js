/**
 * Main.
 *
 * @package
 * @category    admin
 * @copyright  2024 mattandor <mattan@centricapp.co.il>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_stream/main",["jquery","core/ajax","core/notification","core/str","core/url"],(function($,ajax,notification,str,url){return{init:function(){var self=this;this.elements=$("#stream-elements"),this.loadingbars=url.imageUrl("icones/loading-bars","stream"),$("body").on("click","#stream-elements .list-item-grid",(function(){var itemid=$(this).data("itemid"),topic=$(this).find(".title").text();self.selected(itemid,topic)})),$("body").on("click",".btn-upload",(function(e){e.preventDefault(),$("#upload_stream").toggle()})),$("#stream-title-search").val($("#id_topic").val()).keyup((function(){self.load()})),this.load(),window.addEventListener("message",this.message,!1)},message:function(event){event.data&&event.data.streamid&&($("#id_identifier").val(event.data.streamid),$("#id_topic").val(event.data.topic),$("#upload_stream").hide())},load:function(){var self=this;self.elements.html('<div style="text-align:center"><img height="80" src="'+self.loadingbars+'" ></div>'),$("html, body").animate({scrollTop:self.elements.offset().top-100},800),ajax.call([{methodname:"mod_stream_video_list",args:{term:$("#stream-title-search").val(),courseid:$('input[name="course"]').val()}}])[0].then((function(response){return self.list(response,self)})).catch((function(error){return self.failed(error,self)}))},selected:function(identifier,topic){setTimeout((function(){$("#id_identifier").val(identifier),$("#id_topic").val(topic),$(".list-item-grid").find(".item").removeClass("selected"),$("#video_identifier_"+identifier).find(".item").addClass("selected")}),100)},failed:function(error,self){return str.get_string("servererror","moodle").then((function(connectionfailed){return self.elements.html('<div class="alert alert-danger">'+connectionfailed+"</div>")}))},list:function(response,self){if(self.selected($("#id_identifier").val(),$("#id_topic").val()),"success"==response.status){if(!response.videos.length)return str.get_string("noresults","mod_stream").then((function(noresults){return self.elements.html('<div class="alert alert-info">'+noresults+"</div>")}));self.elements.html(""),$.each(response.videos,(function(key,video){var html='<div class="col list-item-grid" data-itemid="'+video.id+'" id="video_identifier_'+video.id+'"><span class="item" ><div class="thumbnail"><img src="'+video.thumbnail+'" class="img-fluid img-rounded"><span class="duration">'+video.duration+'</span></div><span class="title">'+video.title+"</span></span></div>";self.elements.append(html)}))}return!0}}}));

//# sourceMappingURL=main.min.js.map